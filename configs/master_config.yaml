# HWO-SLAPS Configuration

# Run identification
run_name: hexike_run
global_seed: 11  # null=random, int=reproducible 

# Output and plotting
plotting:
  enabled: true
  output_dir: /Users/vassig/research/hwo/outputs

# Lensing system generation
lensing:
  # Coordinate grid
  grid:
    shape: [500, 500]  # pixels
    pixel_scale: 0.00716  # arcsec/pixel
    
  # Main lens galaxy
  lens_galaxy:
    redshift: 0.2
    mass:
      type: Isothermal
      einstein_radius: 1  # arcsec
      centre: [0.0, 0.0]
      ell_comps: [0.1, 0.0]  # Ellipticity
      
  # Background source galaxy
  source_galaxy:
    redshift: 2.5
    light:
      type: Exponential
      centre: [-0.03, 0.08]
      ell_comps: [0.14516129, 0.25142673]
      intensity: 2.0
      effective_radius: 0.11
      
  # Dark matter subhalo
  subhalo:
    enabled: true  # Set to false to create system with no subhalo
    mass: 1.0e9  # Solar masses
    model: NFW  # PointMass, SIS, or NFW
    position:
      type: 'random'        # 'random', 'angle', or 'direct'
      scatter_pixels: 20    # Random scatter ±10 pixels around Einstein ring
      # For fixed-angle placement (on Einstein ring):
      # angle: 90.0          # degrees (0-360), measured from +x toward +y
      # offset_pixels: 0     # optional radial offset in pixels (default 0)
      # For direct placement only:
      # centre: [0.12, 0.81]  # [y, x] in arcseconds
    
  # Cosmology
  cosmology: Planck15

# PSF generation with aberrations
psf:
  # Telescope parameters
  telescope:
    gap_size: 0.006  # m
    segment_point_to_point: 1.65 # m
    pupil_diameter: 7.225765  # m
    num_rings: 2
    focal_length: 144.0  # m
    supersampling_factor: 4
    
  # High-resolution PSF parameters (for metrics calculation)
  hres_psf:
    num_pix: 512
    wavelength: 5.0e-7  # m
    num_airy: 12
    sampling: 5
    save_highres_psf_npy: true  # Save pre-downsampled PSF intensity as .npy
    
  # Kernel parameters (for PyAutoLens)
  kernel:
    shape_native: [51, 51]  # Final kernel dimensions
    
  # Aberrations
  aberrations:
    # Choose between manual and API methods for segment aberrations
    use_api: true  # Set to true to use HCIPy API for segment hexikes
    
    # Toggle flags to enable/disable each aberration type
    enable_segment_pistons: false       
    enable_segment_tiptilts: false
    enable_segment_hexikes: true
    enable_global_zernikes: false
    
    # Segment piston errors in nm 
    segment_pistons:
      0: 0.012  # 12 pm piston on segment 0
      1: 0.015  # 15 pm piston on segment 1
      2: 0.011  # 11 pm piston on segment 2
      3: 0.013  # 13 pm piston on segment 3
      4: 0.014  # 14 pm piston on segment 4
      5: 0.010  # 10 pm piston on segment 5
      6: 0.016  # 16 pm piston on segment 6
      7: 0.018  # 18 pm piston on segment 7
      8: 0.017  # 17 pm piston on segment 8
      9: 0.019  # 19 pm piston on segment 9
      10: 0.013 # 13 pm piston on segment 10
      11: 0.012 # 12 pm piston on segment 11
      12: 0.014 # 14 pm piston on segment 12
      13: 0.015 # 15 pm piston on segment 13
      14: 0.011 # 11 pm piston on segment 14
      15: 0.017 # 17 pm piston on segment 15
      16: 0.018 # 18 pm piston on segment 16
      17: 0.016 # 16 pm piston on segment 17
      18: 0.010 # 10 pm piston on segment 18

    # Segment tip/tilt errors in microradians
    segment_tiptilts:
      0: [0.000012, 0.000012]  # 12 pm equivalent tip/tilt on segment 0
      1: [0.000015, 0.000015]
      2: [0.000011, 0.000011]
      3: [0.000013, 0.000013]
      4: [0.000014, 0.000014]
      5: [0.000010, 0.000010]
      6: [0.000016, 0.000016]
      7: [0.000018, 0.000018]
      8: [0.000017, 0.000017]
      9: [0.000019, 0.000019]
      10: [0.000013, 0.000013]
      11: [0.000012, 0.000012]
      12: [0.000014, 0.000014]
      13: [0.000015, 0.000015]
      14: [0.000011, 0.000011]
      15: [0.000017, 0.000017]
      16: [0.000018, 0.000018]
      17: [0.000016, 0.000016]
      18: [0.000010, 0.000010]
      
    # Segment-level hexike aberrations in nm RMS
    segment_hexikes:
      0: {0: 100}  # Segment 0: hexike 0 with 100 nm
      1: {1: 100}  # Segment 1: hexike 1 with 100 nm
      2: {2: 100}  # Segment 2: hexike 2 with 100 nm
      3: {3: 100}  # Segment 3: hexike 3 with 100 nm
      4: {4: 100}  # Segment 4: hexike 4 with 100 nm
      5: {5: 100}  # Segment 5: hexike 5 with 100 nm
      6: {6: 100}  # Segment 6: hexike 6 with 100 nm
      7: {7: 100}  # Segment 7: hexike 7 with 100 nm
      8: {8: 100}  # Segment 8: hexike 8 with 100 nm
      9: {9: 100}  # Segment 9: hexike 9 with 100 nm
      10: {10: 100}  # Segment 10: hexike 10 with 100 nm
      11: {11: 100}  # Segment 11: hexike 11 with 100 nm
      12: {12: 100}  # Segment 12: hexike 12 with 100 nm
      13: {13: 100}  # Segment 13: hexike 13 with 100 nm
      14: {14: 100}  # Segment 14: hexike 14 with 100 nm
      15: {15: 100}  # Segment 15: hexike 15 with 100 nm
      16: {16: 100}  # Segment 16: hexike 16 with 100 nm
      17: {17: 100}  # Segment 17: hexike 17 with 100 nm
      18: {18: 100}  # Segment 18: hexike 18 with 100 nm
      
    # Global Zernike aberrations in nm RMS
    global_zernikes:
      4: 5    # Focus (Z4)
      5: 5    # Coma X (Z7)
      8: 5    # Coma Y (Z8)

# Observation simulation parameters
observation:
  exposure_time: 900.0  # seconds
  output_format: "pyautolens_ready"  # "adu" or "pyautolens_ready"
  
  # Detector configuration
  detector:
    gain: 1.0           # e-/ADU
    read_noise: 0.2     # e-/pixel
    dark_current: 0.002 # e-/pixel/s
    sky_background: 1.0 # e-/pixel/s (zodiacal light dominated)

# Module 4: Subhalo Detection
modeling:
  enabled: true  # Set to true to enable detection mode
  snr_threshold: 10.0                           # Absolute SNR threshold for pixel masking (Mejiro paper-exact)
  significance_levels: [1.349898e-3, 3.167124e-5, 2.866516e-7]  # 3σ, 4σ, 5σ p-values
  detection: 'gof'     # 'gof' (legacy chi-square), 'chernoff', or 'mejiro' (paper-exact)
  #alpha: 2.866516e-7      # ~3σ one-sided (Mejiro threshold)
  #dof_offset: -3          # dof = N_mask - 3 (Mejiro)
